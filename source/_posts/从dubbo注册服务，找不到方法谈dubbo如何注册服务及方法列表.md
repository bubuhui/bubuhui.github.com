---
title: 从dubbo注册服务，找不到方法谈dubbo如何注册服务及方法列表
date: 2016-08-24 22:56:08
tags: [dubbo,java]
categories: [dubbo研究]
---

#### 起因

- ​	某一天，同事发现他某一个接口注册的dubbo服务，没有方法列表，方法列表是一个*，其他dubbo服务都是正常的。具体情况如下：


- 该接口是父类接口，下面有子类接口，子类接口注册的dubbo服务均可以获取方法列表。
- **该接口打包到jar中就找不到方法列表，解压到class下面就可以。**
- 该接口有100个方法。

#### 排查过程

​	经验丰富的朋友们看到上面的问题描述大概可以猜测到原因了。我这边在排查的时候一下子就把关键地方给忽略过去了。

- 由于问题产生的现象是打包到jar中才出现的，因此考虑打包的原因，排查打包的jdk版本信息，所有都替换成一致之后，问题仍未解决。
- 考虑到该接口作为父类接口使用，怀疑是不是父类接口的原因，重新写了几个测试用例，包括父类接口，子接口，无子类接口几种情况，发现所有接口列表都是正常的，证明继承关系不影响接口的方法列表。
- 考虑到该接口方法较多，有100个，测试例子中，写了1000个方法，仍然正常获取到方法列表。
- copy了一份该接口，接口实现类，重新注册了一个dubbo服务，发现一切正常。
- 考虑是不是有相同的接口（包路径，类名都相同）覆盖掉了该接口。在IDE下搜索，果然发现了一个空的相同接口。

#### 总结

​	由于另外一个相同接口是在jar里面，而class目录下面的class会优先搜索加载（**这里需要去看一下class、jar的加载机制及时机**），导致解压出来后就没问题，而打成jar包就有问题。至于为什么开始没考虑到相同的接口覆盖，这个有两个原因：

- 自身理解得不够深刻，这么明显和class加载顺序有关的问题，没有第一时间反应过来。
- 开始在IDE下使用 CTRL+T 和 CTRL + R 搜索过，嫌弃CTRL + T 太慢，应该是还没看全就 CTRL +R 切换过去了。
- 开始也想过从dubbo注册服务时候调试，不过没有研究过dubbo代码，一时不好下手，就放弃了。如果当时知道dubbo注册机制，就可以直接找到问题了。

#### dubbo如何注册服务？

​	这里先暂时留着，有时间再接着写。